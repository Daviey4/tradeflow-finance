{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}TradeFlow{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', system-ui, sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        @keyframes pulse-glow {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        .animate-pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #18181b; }
        ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #52525b; }
        
        /* Chart canvas */
        .chart-container { position: relative; }
    </style>
    {% block extra_css %}{% endblock %}
</head>
<body class="bg-black text-white min-h-screen">
    <!-- Animated Background -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="absolute -top-1/2 -left-1/2 w-full h-full bg-gradient-to-br from-emerald-500/5 via-transparent to-transparent rounded-full blur-3xl animate-pulse-glow"></div>
        <div class="absolute -bottom-1/2 -right-1/2 w-full h-full bg-gradient-to-tl from-violet-500/5 via-transparent to-transparent rounded-full blur-3xl animate-pulse-glow" style="animation-delay: 1s;"></div>
    </div>

    <!-- Header -->
    <header class="relative z-10 border-b border-zinc-800/50 backdrop-blur-xl bg-black/50 sticky top-0">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4 sm:gap-6">
                    <a href="{% url 'trading:dashboard' %}" class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-emerald-400 to-cyan-400 flex items-center justify-center">
                            <span class="text-black font-black text-lg">‚ö°</span>
                        </div>
                        <div class="hidden sm:block">
                            <h1 class="text-xl font-bold tracking-tight">TradeFlow</h1>
                            <p class="text-xs text-zinc-500">Automated Trading</p>
                        </div>
                    </a>
                    
                    <nav class="flex items-center gap-1 bg-zinc-900/50 rounded-full p-1">
                        <a href="{% url 'trading:dashboard' %}" 
                           class="px-3 sm:px-4 py-2 rounded-full text-sm font-medium transition-all {% if request.resolver_match.url_name == 'dashboard' %}bg-white text-black{% else %}text-zinc-400 hover:text-white{% endif %}">
                            Dashboard
                        </a>
                        <a href="{% url 'trading:trades' %}" 
                           class="px-3 sm:px-4 py-2 rounded-full text-sm font-medium transition-all {% if request.resolver_match.url_name == 'trades' %}bg-white text-black{% else %}text-zinc-400 hover:text-white{% endif %}">
                            Trades
                        </a>
                        <a href="{% url 'trading:alerts' %}" 
                           class="px-3 sm:px-4 py-2 rounded-full text-sm font-medium transition-all {% if request.resolver_match.url_name == 'alerts' %}bg-white text-black{% else %}text-zinc-400 hover:text-white{% endif %}">
                            Alerts
                        </a>
                        <a href="{% url 'trading:calculator' %}" 
                           class="px-3 sm:px-4 py-2 rounded-full text-sm font-medium transition-all {% if request.resolver_match.url_name == 'calculator' %}bg-white text-black{% else %}text-zinc-400 hover:text-white{% endif %}">
                            Calculator
                        </a>
                        <a href="{% url 'trading:security_lab' %}" 
                           class="px-3 sm:px-4 py-2 rounded-full text-sm font-medium transition-all {% if request.resolver_match.url_name == 'security_lab' %}bg-white text-black{% else %}text-zinc-400 hover:text-white{% endif %}">
                            üîê Lab
                        </a>
                    </nav>
                </div>

                <div class="flex items-center gap-2 sm:gap-4">
                    <div id="api-status" class="flex items-center gap-2 px-3 py-1.5 rounded-full text-xs font-medium bg-zinc-800 text-zinc-400 border border-zinc-700">
                        <span class="w-2 h-2 rounded-full bg-zinc-600"></span>
                        <span class="hidden sm:inline">Connecting...</span>
                    </div>
                    
                    <button onclick="requestNotificationPermission()" id="notif-btn" class="p-2 rounded-xl bg-zinc-800 text-zinc-400 hover:text-white transition-all" title="Enable Notifications">
                        üîî
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 py-6 sm:py-8 pb-24">
        {% block content %}{% endblock %}
    </main>

    <!-- Status Bar -->
    <footer class="fixed bottom-0 left-0 right-0 bg-zinc-900/80 backdrop-blur border-t border-zinc-800 py-3 px-4 sm:px-6 z-20">
        <div class="max-w-7xl mx-auto flex items-center justify-between text-sm">
            <div class="flex items-center gap-4 sm:gap-6">
                <span id="bot-status" class="flex items-center gap-2 text-zinc-500">
                    <span class="w-2 h-2 rounded-full bg-zinc-600"></span>
                    Bot Stopped
                </span>
                <span class="text-zinc-500 hidden sm:inline">
                    Strategy: <span id="current-strategy" class="text-white">Threshold</span>
                </span>
            </div>
            <div class="flex items-center gap-4 sm:gap-6 text-zinc-500">
                <span>Balance: <span id="footer-balance" class="text-white font-mono">$0.00</span></span>
                <span class="hidden sm:inline">Holdings: <span id="footer-holdings" class="text-white font-mono">0</span></span>
            </div>
        </div>
    </footer>

    <!-- Global JavaScript -->
    <script>
        // Notification permission
        let notifPermission = Notification.permission || 'default';
        
        function requestNotificationPermission() {
            if ('Notification' in window) {
                Notification.requestPermission().then(permission => {
                    notifPermission = permission;
                    updateNotifButton();
                    if (permission === 'granted') {
                        showNotification('system', 'Notifications enabled!');
                    }
                });
            }
        }
        
        function updateNotifButton() {
            const btn = document.getElementById('notif-btn');
            if (notifPermission === 'granted') {
                btn.classList.remove('bg-zinc-800', 'text-zinc-400');
                btn.classList.add('bg-emerald-500/10', 'text-emerald-400');
            }
        }
        
        function showNotification(type, message) {
            if (notifPermission === 'granted') {
                try {
                    new Notification(`TradeFlow: ${type.toUpperCase()}`, { body: message });
                } catch (e) {}
            }
        }
        
        // Update API status indicator
        function updateApiStatus(status) {
            const el = document.getElementById('api-status');
            const dot = el.querySelector('span:first-child');
            const text = el.querySelector('span:last-child');
            
            el.classList.remove('bg-emerald-500/10', 'text-emerald-400', 'border-emerald-500/20',
                               'bg-amber-500/10', 'text-amber-400', 'border-amber-500/20',
                               'bg-red-500/10', 'text-red-400', 'border-red-500/20',
                               'bg-zinc-800', 'text-zinc-400', 'border-zinc-700');
            dot.classList.remove('bg-emerald-400', 'bg-amber-400', 'bg-red-400', 'bg-zinc-600', 'animate-pulse');
            
            if (status === 'connected') {
                el.classList.add('bg-emerald-500/10', 'text-emerald-400', 'border-emerald-500/20');
                dot.classList.add('bg-emerald-400', 'animate-pulse');
                if (text) text.textContent = 'Live';
            } else if (status === 'connecting') {
                el.classList.add('bg-amber-500/10', 'text-amber-400', 'border-amber-500/20');
                dot.classList.add('bg-amber-400', 'animate-pulse');
                if (text) text.textContent = 'Syncing...';
            } else {
                el.classList.add('bg-red-500/10', 'text-red-400', 'border-red-500/20');
                dot.classList.add('bg-red-400');
                if (text) text.textContent = 'Offline';
            }
        }
        
        // CSRF token helper
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        
        const csrftoken = getCookie('csrftoken');
        
        // Initialize
        updateNotifButton();
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>
